<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Bean Run Mobile</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #000;
      color: #fff;
      font-family: ui-monospace, Menlo, monospace;
    }

    #back-home {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.3);
      padding: 0.6rem 1rem;
      border-radius: 8px;
      font-weight: bold;
      font-size: 0.95rem;
      cursor: pointer;
      backdrop-filter: blur(3px);
    }

    .game-wrap {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      touch-action: none;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
    }

    .hud {
      position: absolute;
      inset: 0;
      pointer-events: none;
      color: #eee;
    }

    .hud .hi {
      position: absolute;
      top: 8px;
      left: 12px;
      opacity: 0.85;
      text-shadow: 0 1px 0 #0008;
    }

    .hud .score {
      position: absolute;
      top: 8px;
      right: 12px;
      font-weight: 700;
      text-shadow: 0 1px 0 #0008;
    }

    .center {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .card {
      background: rgba(0,0,0,0.6);
      color: #eee;
      border: 1px solid #ffffff1a;
      border-radius: 10px;
      padding: 14px 18px;
      text-align: center;
    }

    .sub {
      font-size: 0.9rem;
      opacity: 0.9;
    }

    #controls {
      position: fixed;
      bottom: 0;
      width: 100%;
      display: flex;
      justify-content: space-between;
      background: rgba(0,0,0,0.3);
      padding: 1rem 2rem;
      z-index: 9998;
    }

    .ctrl {
      flex: 1;
      text-align: center;
      padding: 1rem;
      margin: 0 0.5rem;
      background: rgba(255,255,255,0.1);
      border-radius: 10px;
      font-weight: bold;
      font-size: 1.2rem;
      user-select: none;
      color: #fff;
    }

    .ctrl:active {
      background: rgba(255,255,255,0.25);
    }
  </style>
</head>

<body>
  <button id="back-home">üè† Return to Homepage</button>

  <div class="game-wrap">
    <canvas id="game" width="960" height="320"></canvas>
    <div class="hud">
      <div class="hi" id="hi">HI 00000</div>
      <div class="score" id="score">00000</div>
      <div class="center" id="center">
        <div class="card">
          <div style="font-weight:700">Tap to Begin</div>
          <div class="sub">Tap right to jump ‚Ä¢ Tap left to duck</div>
        </div>
      </div>
    </div>
  </div>

  <div id="controls">
    <div id="duck" class="ctrl">‚¨áÔ∏è</div>
    <div id="jump" class="ctrl">‚¨ÜÔ∏è</div>
  </div>

  <script>
    // Redirect home
    document.getElementById('back-home').addEventListener('click', () => {
      window.location.href = 'index.html';
    });

    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    let W = canvas.width, H = canvas.height;

    function resize() {
      W = canvas.width = window.innerWidth;
      H = canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    const scoreEl = document.getElementById('score');
    const hiEl = document.getElementById('hi');
    const centerEl = document.getElementById('center');
    const fmt = n => n.toString().padStart(5, '0');

    const STATE = {
      started:false, running:false, over:false, paused:false,
      last:0, speed:6,
      score:0, hi:Number(sessionStorage.getItem('bean_hi') || 0),
      gravity:1.05
    };

    const GROUND_Y = H - 80, GROUND_H = 20;
    const PLAYER = { x:80, y:GROUND_Y-40, w:60, h:60, vy:0, duck:false, onGround:true };
    const obstacles = [];
    let spawnCooldown = 900;

    const IMG = {
      beanRun: new Image(),
      beanDuck: new Image(),
      squirrel: new Image()
    };
    IMG.beanRun.src = 'img/bean_run.png';
    IMG.beanDuck.src = 'img/bean_duck.png';
    IMG.squirrel.src = 'img/squirrel.png';

    function startGame(){
      STATE.started = true; STATE.running = true; STATE.over = false;
      STATE.score = 0; STATE.speed = 6; obstacles.length = 0;
      spawnCooldown = 900;
      Object.assign(PLAYER, { y:GROUND_Y-40, vy:0, duck:false, onGround:true });
      centerEl.style.display = 'none';
      STATE.last = performance.now();
      requestAnimationFrame(loop);
    }

    function jump() {
      if (!STATE.running || STATE.paused || STATE.over) return;
      if (PLAYER.onGround) {
        PLAYER.vy = -12;
        PLAYER.onGround = false;
        PLAYER.duck = false;
      }
    }

    function setDuck(d) {
      if (!STATE.running || STATE.paused || STATE.over) return;
      PLAYER.duck = !!d;
    }

    function gameOver() {
      STATE.running = false; STATE.over = true;
      const s = Math.floor(STATE.score);
      if (s > STATE.hi) { STATE.hi = s; sessionStorage.setItem('bean_hi', String(s)); }
      scoreEl.textContent = fmt(s); hiEl.textContent = 'HI ' + fmt(STATE.hi);
      centerEl.style.display = 'flex';
      centerEl.querySelector('.card').innerHTML = `<div style="font-weight:700">Game Over</div><div>Score: ${fmt(s)}</div><div class="sub" style="margin-top:.25rem">Tap to retry</div>`;
    }

    function loop(now) {
      if (!STATE.running) return;
      const dt = Math.min(32, now - STATE.last);
      const dts = dt / (1000 / 60);
      STATE.last = now;
      update(dts, dt);
      draw();
      requestAnimationFrame(loop);
    }

    function update(dts, dt) {
      spawnCooldown -= dt;
      if (spawnCooldown <= 0) {
        spawnObstacle();
        spawnCooldown = 900 + Math.random() * 500;
      }

      if (!PLAYER.onGround) {
        PLAYER.vy += STATE.gravity * dts * 0.5;
        PLAYER.y += PLAYER.vy * dts;
        if (PLAYER.y >= GROUND_Y - PLAYER.h) {
          PLAYER.y = GROUND_Y - PLAYER.h;
          PLAYER.vy = 0;
          PLAYER.onGround = true;
        }
      } else if (PLAYER.duck) {
        PLAYER.h = 40; PLAYER.y = GROUND_Y - PLAYER.h;
      } else {
        PLAYER.h = 60; PLAYER.y = GROUND_Y - PLAYER.h;
      }

      for (let i = obstacles.length - 1; i >= 0; i--) {
        const o = obstacles[i];
        o.x -= STATE.speed * dts;
        if (o.x + o.w < 0) obstacles.splice(i, 1);
        if (hit(playerBox(), o.box())) return gameOver();
      }

      STATE.score += 0.4 * dts;
      scoreEl.textContent = fmt(Math.floor(STATE.score));
      hiEl.textContent = 'HI ' + fmt(STATE.hi);
    }

    function Plate() {
      const size = 34, y = GROUND_Y - size + 6;
      return {
        type:'plate', x: W+10, y, w:size, h:size,
        box(){ const p=6; return {x:this.x+p,y:this.y+p,w:this.w-2*p,h:this.h-2*p}; },
        draw(){
          ctx.fillStyle = '#333';
          ctx.beginPath();
          ctx.arc(this.x+size/2, this.y+size/2, size/2, 0, Math.PI*2);
          ctx.fill();
        }
      };
    }

    function Squirrel(){
      const baseY = GROUND_Y - 120;
      return {
        type:'squirrel', x:W+10, y:baseY, w:52, h:40,
        box(){ const p=4; return {x:this.x+p,y:this.y+p,w:this.w-2*p,h:this.h-2*p}; },
        draw(){ ctx.drawImage(IMG.squirrel, this.x, this.y, this.w, this.h); }
      };
    }

    function spawnObstacle() {
      const type = Math.random() < 0.4 ? 1 : 0;
      obstacles.push(type ? Squirrel() : Plate());
    }

    function playerBox() { const p=6; return {x:PLAYER.x+p,y:PLAYER.y+p,w:PLAYER.w-2*p,h:PLAYER.h-2*p}; }
    function hit(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

    function draw() {
      ctx.clearRect(0,0,W,H);
      drawBackground();
      drawGround();
      drawPlayer();
      for (const o of obstacles) o.draw();
    }

    function drawBackground() {
      const sky = ctx.createLinearGradient(0,0,0,H);
      sky.addColorStop(0,'#89c9ff');
      sky.addColorStop(1,'#d0ecff');
      ctx.fillStyle = sky;
      ctx.fillRect(0,0,W,H);
    }

    function drawGround() {
      ctx.fillStyle = '#222';
      ctx.fillRect(0,GROUND_Y,W,GROUND_H);
    }

    function drawPlayer() {
      const img = (PLAYER.duck && PLAYER.onGround) ? IMG.beanDuck : IMG.beanRun;
      ctx.drawImage(img, PLAYER.x, PLAYER.y, PLAYER.w, PLAYER.h);
    }

    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      if (!STATE.started || STATE.over) startGame();
    });

    document.getElementById('jump').addEventListener('touchstart', e => { e.preventDefault(); jump(); });
    document.getElementById('duck').addEventListener('touchstart', e => { e.preventDefault(); setDuck(true); });
    document.getElementById('duck').addEventListener('touchend', e => { e.preventDefault(); setDuck(false); });
  </script>
</body>
</html>
